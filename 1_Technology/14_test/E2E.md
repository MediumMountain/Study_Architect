# E2E (End to End Test)

- ユーザーの実際の利用環境に基づき、システムが正しく動作するか・データフローが適切に機能するかどうかを、システム全体を通して検証するテスト
    - システムやソフトウェアで利用するコンポーネントやレイヤーをすべて結合した状態で、ユーザーエクスペリエンスを最初から最後まで徹底的にテストする
    - ユーザーの実際の利用環境において、想定されたすべてのシナリオに基づいてシミュレーションする

- 総合テストフェーズで実施されるもので、UI(User Interface Test)テストと呼ばれることもある。

- テスト仕様書に基づき手動で行うケースが多く、業務負担がかかることからほかのテスト手法と比べて実装されにくい点も特徴


## メリットとデメリット

### メリット
- E2Eテストの主なメリットは、「ユーザー視点でのテストができる」「環境固有の問題を発見できる」の2点

- ユーザー視点でのテストができる
    - E2Eテストでは、システム全体を通してユーザーエクスペリエンスを徹底的に検証する。
    - ユーザー視点でのテストは、本来実現したい機能が実現できているかどうかに加えて、使い勝手のよさなども把握でき、よりユーザビリティの高いシステム開発につながる

- 環境固有の問題を発見できる
    - テスト環境と本番環境においては、どうしても差異が生じてしまう傾向にあることから、システムテストは可能な限り本番環境に近い環境で実装することが推奨されている。
    - E2Eテストは使用ユーザーの視点に立ち、想定されるシナリオに基づいて実装するテストとなっているため、本番環境特有の問題を発見しやすい点がメリットと言える


### デメリット
- テストに時間がかかる
    - E2Eテストでは、適切なデバイスを用いて実際にサーバーやブラウザ・サイトを使用することから、時間がかかりやすい点が特徴。
    - 想定されるテストシナリオが多ければ多いほど、工程・工数も増える。
        - 大きな問題を発見した場合は、大幅なメンテナンスが必要となる可能性があることにも注意が必要。

- テスト設計が難しい
    - E2Eテストは、想定したシナリオに基づいて徹底的に検証するものであることから、テスト要件が膨大になりやすい。
    - テストに時間がかかるだけでなく、設計の難易度も高まる。
    - 可能な限り短期間でテスト実装を終えるためには、ユーザーの目的をきちんと理解したうえでテスト設計を行わなければならない点に注意が必要



## 不安定

### なぜ不安定になるか
E2Eテストが不安定になるには様々な理由があります。  
ユニットテストと異なり、ネットワークアクセス、DBアクセス、ファイルアクセスなど、外部通信が発生するのでそれらの影響を受け、成功していたテストが失敗したりします。  
また変更の影響も受けやすく、例えばWebシステムの場合、デザインの変更などで今まで通っていたテストが失敗することがあります。  

### 不安定なE2Eテストがもたらす悪影響
- 修正に時間がかかる
    - 実行のたびに何処かでテストが失敗するとそれを修正する手間がかかります。
    - たとえば通信待ちでテストがタイムアウトした場合、そのテストケースを実際に実行してみて、テストが通るような待ち時間を設定する必要があります。
    - また、安定していたと思ったテストは別の環境で実行すると、その環境の外部要因でまた失敗することがあります。

- テストが落ちていても無視するようになる
    - テスト結果が不安定なままになっていると、そのうち失敗している状態が重要視されないようになります。
    - これにより、本当にシステムに問題が起きた時に気づくのが遅れます。
    - かならず失敗するテストは直せばよいだけなので、不安定なテストはかならず失敗するテストよりも悪い状態です。

### 不安定なE2Eテストに対する対処法
- テストを書き直す
    - テストシナリオが正しいか、テストの記述方法に改善点（使用するメソッド、テストプログラムの設計など）はないか確認します。
- テストをピラミッドの下の層へ移動させる
    - ユニットテストはフィードバックも早く、安定的に動作します。
    - なにもかもE2Eテストでカバーせずに、ユニットテストで機能を担保できないか検討します。
- 価値のないテストとみなし、テストを止める
    - 全てのユースケースの自動テストを安定的に機能させるのは、作業コストが大きくなります。
    - 不安定な場合は潔く諦めて、手動で検証することを検討します。


## REFERENCE
https://qiita.com/mt0m/items/7e18d8802843d9f60d28  
