# 通信規格


## Zigbee
低コスト、低消費電力でワイヤレスセンサーネットワーク構築に適した無線通信規格
センサーネットワークを主目的とする近距離無線通信規格である。 転送可能距離が短く転送速度も非常に低速だが、安価で消費電力が少なく、電池駆動可能な超小型機器の実装に適する。 基礎部分の電気的仕様はIEEE 802.15.4として規格化されている。


自由なアプリケーション開発を促進する標準化

　ZigBeeの標準化は、2001年に設立されたZigBee Allianceが中心となって進められています。国内の団体としてZigBee SIGジャパンがZigBeeの普及促進のための活動を行っています。

　ZigBeeの基本部分は、低伝送速度の無線PANの規格であるIEEE 802.15.4によって定められています。また、ZigBee以前に家電ネットワーク向けの通信規格として検討されていたHomeRF Liteの技術を転用しています。

　ZigBee Allianceは、ネットワークやアプリケーション部分の標準化を行い、2004年12月にZigBee 1.0を発表しました。その後も拡張作業は継続しており、2006年12月には機能を拡張したZigBee 2006が、2007年10月にはZigBee Pro（ZigBee 2007、一般公開は2008年予定）が定められました。また、ZigBee Allianceは適合性認証テストなども行っています。

　ZigBeeの標準化の特徴の1つとして、プロファイルに対する柔軟さが挙げられます。プロファイルとは、用途ごとに分けたれたアプリケーション間の相互接続をスムーズにするための共通ルールのことです。Bluetoothもプロファイルがありますが、標準化団体が定めたもの以外を認めなかったため、応用が難しくなってしまいました。

　ZigBeeのプロファイルには、ZigBee Allianceが定めたもの（Public Profile）のほか、メーカーが開発して公開したもの（Published Profile）、メーカーが独自に運用して



日本で使えるのは2.4GHz帯だけ

　ZigBeeのアーキテクチャは、物理層、MAC層、ネットワーク層、アプリケーション層に分かれており、アプリケーション層にはアプリケーションサブ層が含まれているため5層構造になっています。各層のサービスのインターフェイスはプリミティブと呼ばれ、要求、確認、応答、通知の4種類の中から必要なものを備えています。

　物理層とMAC層はIEEE 802.15.4の規定に従い、ネットワーク層とアプリケーションサポートサブ層はZigBee Allianceが標準化を担当しています。アプリケーションの開発はユーザーに任されていますが、ZigBee Allianceから開発環境としてZigBeeアプリケーションフレームワークとネットワーク管理機能のZigBeeデバイスオブジェクトが提供されています。

　物理層では、使用周波数やチャネル、変調、通信フレームなどが定められています。ZigBeeの使用周波数は、868MHz、915MHz、2.4GHzの3種類が規定されていますが、電波法の関係で国内では2.4GHzのZigBeeしか使えません。



適所適材なネットワークトポロジーを選べる

　ZigBeeのネットワークトポロジーの基本は、スター型とPtoP（Peer to Peer）型の2種類です。後者によってメッシュネットワークを構築できることが、ほかの無線PANにない特徴といえるでしょう。

　スター型のネットワークは、中心にZigBeeコーディネータ（ZigBeeルータ）を置き、その周囲にZigBeeエンドポイントを配置します。通信は1ホップのみで、非常にシンプルなネットワークです。エンドポイントは通信が必要なときだけ起動すればいいので、省電力なネットワークになります。なお、スター型ネットワークに親子関係を持たせたクラスタツリー型のネットワークを構築することも可能です。

　PtoP型のネットワークは、すべてのノードにルータ機能を持つFFDを配置して、メッシュ型のネットワークを構築できます。マルチホップ通信ができることで、1つのノードから見て電波が届かないノードまでデータを送信することができます。また、通信経路が冗長化されるというメリットもあります。しかし、端末をスリープさせることが難しく、電力消費も大きくなります。

　また、スター型、クラスタツリー型、メッシュ型のネットワークを組み合わせるハイブリッド（コンバインド）ネットワークも構築可能です。センサーネットワークなどの場合、センサーノードはスター型、集計ノードはメッシュ型のように適所適材でネットワークトポロジーを選択できます。


混信を制御するための競争と協調

　ZigBeeでは、混信を防ぐためのアクセス制御方式として、伝送路の状態を確認して、空いていればランダムな時間を待ってデータを送信するCSMA/CA（Carrier Sense Multiple Access with Collision Avoidance）が採用されています。イーサネットでもCSMA/CD（Carrier Sense Multiple Access with Collision Detection）として利用されている方式なので、なじみのある方も多いのではないでしょうか。

　しかし、ZigBeeには隠れノード問題という課題が残されています。目標ノードTに対してデータを送信しようとするノードAとBがお互いの通信範囲の外にある場合、AとBはキャリアセンスできず、ノードTで衝突が発生するのです。

　ZigBeeでは、これを防ぐためにスーパーフレームという仕組みを導入しました。これにより、それぞれのノードは、CAP（Contention Access Period）と呼ばれるCSMA/CAによる自由競争による通信時間と、CFP（Contention Free Period）と呼ばれるZigBeeコーディネータに許可を得たノードだけがデータを送信できる通信時間に従うことになりました。

　スーパーフレームは、ネットワーク内の同期を取るためのビーコンから始まり、CAP、CFP、非活動時間（Inactive Period）までを周期となっています。




IrDa

1993年に設立された、赤外線を利用した近距離データ通信の技術標準を策定する業界団体。また、同団体が定めた赤外線通信の規格。主にノートパソコンや携帯電話、デジタルカメラなどの外部通信機能として利用されている。

1対1で高速なデータ通信を行うためのIrDA DATAと、周辺機器との接続などを想定した複数台の機器と双方向に通信を行うためのIrDA Controlがあり、携帯電話などで主に利用されているのはIrDA DATAである。IrDA DATAは1.0から1.4までのバージョンがあり、最新の1.4では1.0mまでの距離で16Mbpsまでの通信が可能。

IrDA Control (IrBus)
赤外線を利用して複数の機器を接続し、双方向の通信を行う規格。IrDA規格の拡張仕様で、シャープ、Hewlett-Packard社、Intel社、Microsoft社が共同で提案し、1998年2月にIrDAによって標準化された。「IrBus」は正式に規格化される前の名称で、規格化に際して「IrDA Control」に改称された。パソコンなどを中心に約8mまでの距離にある最大8台までの機器を接続でき、75kbpsの速度で双方向に通信を行うことができる。

IrSimple
赤外線を利用して近距離の無線データ通信を行うための規格で、IrDAを高度化したもの。NTTドコモ、シャープ、ITXイー・グローバレッジ（当時）、早稲田大学が共同開発したもので、2005年8月に業界団体IrDAによって標準化された。

IrSimpleは従来のIrDA標準を高速化したもので、ハードウェアは同じものが使用できる。IrSimple-4Mでは最高4Mbpsでの通信が可能。通信手順（プロトコル）を効率化することにより、特に大きなサイズのデータのやり取りで高い転送効率を実現している。古いIrDA規格の機器でも、ソフトウェアを入れ替えることでIrSimpleを利用できるようになる場合もある。

IrSS (IrSimple Shot)
赤外線通信規格であるIrSimpleを簡略化した仕様で、片方向通信を行うためのもの。通信速度や通信方式などはIrSimpleに準拠するが、送信側は一方的にデータを送りつけるだけで、受信側からの応答や再送信要求などは受け付けない。携帯電話やデジタルカメラなどで、写真などのデータを別に機器に送る際に利用された。

MQTT

MQTT（Message Queuing Telemetry Transport）は、リソースに制約のあるデバイスや低帯域幅、高遅延、または信頼性の低いネットワーク向けに設計された、軽量でパブリッシュ・サブスクライブに基づくメッセージングプロトコルである。IoT（Internet of Things）アプリケーションで広く使用されており、センサー、アクチュエーター、などのデバイスの効率的な通信プロトコルを提供します。

MQTTは、IoTシステムの特定の要求に合わせた機能と性能により、最適なIoTプロトコルの1つとしてよく使用されています。主な理由としては、以下のようなものがあります：

軽量：IoT機器は、処理能力、メモリ、エネルギー消費量に制約があることが多い。MQTTはオーバーヘッドが少なく、パケットサイズも小さいため、これらの機器に最適で、リソースの消費も少なく、限られた機能でも効率的な通信が可能です。
信頼性が高い：IoTネットワークでは、高遅延や不安定な接続が発生することがあります。MQTTは、さまざまなQoSレベル、セッション認識、持続的な接続をサポートしており、厳しい条件下でも信頼性の高いメッセージ配信を実現するため、IoTアプリケーションに適しています。
セキュアな通信を実現します：IoTネットワークでは、機密データを送信することが多いため、セキュリティは極めて重要です。MQTTはTLS（Transport Layer Security）とSSL（Secure Sockets Layer）の暗号化をサポートし、伝送中のデータのセキュリティを確保できます。さらに、ユーザー名/パスワード認証やクライアント証明書による認証のメカニズムを提供し、ネットワークとそのリソースへのアクセスを保護します。
双方向性：MQTTのパブリッシュ・サブスクライブモデルは、デバイス間のシームレスな双方向通信を可能にしています。クライアントは、Topicへのメッセージのパプリッシュと、特定のTopicに関するメッセージの受信の両方を行うことができ、デバイス間を直接結合することなく、多様なIoTエコシステムにおいて効果的なデータ交換を可能にします。また、このモデルは、新しいデバイスの統合を簡素化し、容易なスケーラビリティを保証します。
連続性、ステートフル・セッション：MQTT では、クライアントがブローカーとのステートフルなセッションを維持できるため、切断後でもサブスクリプションや未配信のメッセージをシステムが記憶することができます。また、クライアントは接続中にキープアライブ間隔を指定することができ、これによりブローカーは定期的に接続状態を確認するよう促されます。接続が切れた場合、ブローカーは未配信のメッセージを保存し（QoSレベルによる）、クライアントが再接続したときに配信を試みます。この機能により、信頼性の高い通信を実現し、断続的な接続によるデータ消失のリスクを低減します。
大規模なIoTデバイスへの対応：IoTシステムには多数のデバイスが含まれることが多く、大規模なデプロイメントに対応するプロトコルが必要です。MQTTの軽量性、低帯域幅消費、リソースの効率的な使用は、大規模なIoTアプリケーションに適しています。MQTTは、パブリッシュ・サブスクライブ・パターンにより、送信者と受信者を分離し、ネットワークトラフィックとリソース使用量を削減するため、効果的に拡張することができます。さらに、このプロトコルはさまざまなQoSレベルをサポートしているため、アプリケーションの要件に基づいてメッセージ配信をカスタマイズすることができ、さまざまなシナリオで最適なパフォーマンスを確保することができま

多プログラミング言語に対応：IoTシステムには、多くのプログラミング言語を使用して開発されたデバイスやアプリケーションが含まれることがよくあります。MQTTの幅広い言語サポートにより、複数のプラットフォームやテクノロジーとの統合が容易になり、多様なIoTエコシステムにおいてシームレスな通信と相互運用性が促進されます。



MQTTの仕組みは？
MQTTの仕組みを理解するためには、まずMQTT クライアント、MQTT Broker、Publish-Subscribeモード、Topic、QoSの概念をマスターする必要があります：


https://www.emqx.com/ja/blog/the-easiest-guide-to-getting-started-with-mqtt


BLE