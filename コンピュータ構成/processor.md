# プロセッサ　processor
- プロセッサとは、処理装置、処理機、加工業者などの意味を持つ英単語。
- ITの分野では、一定の手順に基づいてデータを変換・演算・加工する機能を持った装置やソフトウェア、システムなどのことをプロセッサという。
- 扱う処理の種類や対象によって「○○プロセッサ」のように用いる。


## マイクロプロセッサ
- 単にプロセッサといった場合は、コンピュータの構成要素のうち、データの演算や変換、プログラムの実行、他の装置の制御などを担う処理装置のことを指すことが多い。
- この意味では「PU」（Processing Unit：プロセッシングユニット）も同義。

- 特に、コンピュータ全体の制御を司る「CPU」（Central Processing Unit：中央処理装置）や、その機能を小さなICチップに集積した「MPU」（Micro-Processing Unit）あるいは「マイクロプロセッサ」（microprocessor）のことをプロセッサと呼ぶことが多い。

- また、CPUの働きを補助あるいは肩代わりし、特定の処理や演算の遂行に特化したプロセッサが用いられることもある。
- 画像処理を行うための「グラフィックスプロセッサ」（GPU：Graphics Processing Unit）や実数計算を高速に処理する「数値演算コプロセッサ」（FPU：Floating-Point Unit）などである。


# CPU【Central Processing Unit】中央処理装置
- コンピュータの主要な構成要素の一つで、他の装置・回路の制御やデータの演算などを行う装置。
- 演算装置と制御装置を統合したもので、現代では一枚のICチップに集積されたマイクロプロセッサ（MPU：Micro-Processing Unit）を用いる。
- CPUはメインメモリ（RAM）に格納された機械語（マシン語）のプログラムを、バスを通じて一命令ずつ順番に読み出し（フェッチ）、その内容を解釈して行うべき動作を決定（デコード）し、内部の回路を駆動して実際に処理を実行する。
- 現代のCPUの多くはマイクロプログラム制御方式を採用しており、機械語の一命令は、より細かな動作（マイクロコード）の組み合わせに分解されてから実行される。

- 命令セット
    - CPUは実行可能な命令の体系が決まっており、これを命令セット（instruction set）あるいは命令セットアーキテクチャ（ISA：Instruction Set Architecture）という。
    - 記憶装置から読み出されたどのようなビット列がどのような動作に対応するかを定めたもので、機械語のプログラムはこれを用いて記述される。

    - 命令セットは各CPUの機種ごとに固有だが、同じメーカーの同じ系列の製品では同じ命令セットが採用されることが多く、その場合は異なる製品が同じプログラムを実行することができる。
    - 同じ命令セットでも製品の世代が下るに連れて新しい命令が追加されることが多く、新しいCPUは古いCPU向けのプログラムも実行できる一方、古いCPUは新しい命令セットのプログラムは実行できないという関係になる（後方互換性）。

    - 有力なメーカーの製品には、別のメーカーが同じ命令セットを採用した互換CPU製品を開発・販売することもある。
    - 例えば、米インテル（Intel）社のx86命令セットは広く普及しており対応ソフトウェアが豊富なため、これをそのまま実行できる互換CPUを米AMD社などが製造している。

- 構造
    - 一般的なCPUの内部は、命令の解釈や他の回路への動作の指示などを行う制御ユニット、論理演算や算術演算を行う演算ユニット（ALU：Arithmetic and Logic Unit）、データの一時的な記憶を行うレジスタ、外部との通信を行うインターフェース回路などで構成される。

    - また、レジスタとメインメモリのあまりに大きな速度差、容量差を埋めるため、両者の中間の速度と容量を併せ持つキャッシュメモリが内蔵されることが多く、浮動小数点演算に特化した演算ユニット（FPU：Floating-Point Unit）なども標準搭載されることが多い。

    - 以前はマザーボード上のチップセットや単体のICチップとして提供されてきた、メモリコントローラやI/Oコントローラ、グラフィックス処理（GPU）などの機能が統合された製品も数多く登場している。
    - コンピュータに必要な機能のほとんどをCPUの内部に統合した製品はSoC（System-on-a-Chip）と呼ばれる。

- 性能
    - 内部の演算回路やレジスタが一回の動作でまとめて伝送、保存、処理できるビット数が決まっており、この値が大きいほど一度に多くのデータを処理でき、また、広大なメモリ空間を一元的に管理できる。
    - 一度にnビットのデータを処理できるCPUをnビットCPUというように呼び、CPUが発明された当初は4ビットであったが、8ビット、16ビット、32ビットと拡張されてゆき、現代では64ビットCPUが広く普及している。
    - また、ほとんどのCPUはコンピュータ内部の特殊な回路から一定周期で発信されるクロック信号に合わせて動作するようにできている。より高い周波数の信号で動作するものほど、単位時間あたりに多くの動作を行うことができ、性能が高い。例えば、2GHz（ギガヘルツ：毎秒10億回）で動作するCPUと1GHzのCPUならば、他の仕様が同じなら約2倍の速度差がある。


- 並行処理
    - 単純な構造のCPUは一つの命令列から一つずつ順番に命令を取り出し実行していくが、現在のCPU製品の多くは、何らかの形で複数の命令、あるいは複数の命令列を同時並行に処理できる機能を内蔵しており、クロックあたりの性能を引き上げている。

    - よく用いられるのはパイプライン処理で、一つの命令を複数の段階に分割してそれぞれを別の回路で実行することにより、いくつかの命令の実行を並行して進めることができる。
    - ある命令が実行段階にあるとき、次の命令がデコードを、その次の命令がフェッチを行うといったように、前の命令の完了を待たずに空いた回路に先行して次の命令を投入する方式である。

    - また、大抵の命令は限られた回路しか利用しないという性質を利用して、空いている回路で実行できる別の命令を同時に投入する方式を同時マルチスレッディング（SMT：Simultaneous Multithreading）という。
    - 擬似的に二つのプログラムを並行に実行することができ、最良の場合で数割の性能向上が果たせる。
    - Intel社のCPUに内蔵されるハイパースレッディング（Hyper-Threading）機能が有名である。

    - 一つの半導体チップの内部に、命令の解釈・実行を行うユニット（CPUコア）自体を複数搭載するという手法も広まっており、マルチコアプロセッサ（multi-core processor）という。
    - それぞれが独立して別のプログラムを並列に実行でき、複数のCPUを搭載するのとほとんど同じ効果を得ることができる。
    - ちなみに、一台のコンピュータに複数のCPUを内蔵する方式はマルチプロセッサ（multiprocessor）という。


### スレッド数【number of threads】論理プロセッサ数 / 論理コア数
- 一つのCPU（MPU/マイクロプロセッサ）が同時に実行状態に置くことができるプログラムの数。
- 最大でこの数だけ並行してプログラムを稼働させることができる。コア数と同数の製品と2倍の製品がある。

- 「スレッド」（thread）は独立した一本の命令の流れで、一つのプログラムが一つのスレッドとなる場合と、プログラム内部で複数のスレッドが枝分かれして並列に実行される場合がある。
- CPUが複数のスレッドを同時に実行することができることを「マルチスレッド」（multi-threading）という。

- CPUが命令を実行する際、一つの命令が使用する回路は限られているため、使われていない回路を利用してもう一つの別の命令を並行して実行する高速化テクニックがある。
- これにより、一つのプロセッサあるいはプロセッサコアが同時に2つの命令列を並行して実行することができるようになる。

- これを一般的には「同時マルチスレッディング」（SMT：Simultaneous Multi-Threading）というが、米インテル（Intel）社は自社製品に内蔵された同様の技術を「ハイパースレッディング」（HT：Hyper-Threading）と呼んでいる。

- SMTに対応したプロセッサコアは同時に2つの命令の流れを実行できるため、プロセッサ全体が実行できるスレッド数はコア数の2倍となる。
- ただし、SMTによる命令実行は完全に並列に行うことはできない（どちらの命令も使用したい回路で待ち時間が生じる）ため、実効的な性能向上は最大で2～3割程度と言われる。

- x86/x64系プロセッサの場合、HT非対応製品では2コアなら2スレッド、4コアなら4スレッドを実行できるが、対応製品では2コアで4スレッド、4コアで8スレッドの実行が可能となる。
- HT機能はBIOS/UEFI設定でオフにすることもでき、その場合は非対応製品と同様にコア数とスレッド数は等しくなる。



### スレッド【thread】
- スレッドとは、撚り糸、筋、脈絡などの意味を持つ英単語。
- ITの分野では、コンピュータが連続して実行する命令の列など、一筋の連続した流れになっているものを比喩的に表す。

- 並行処理のスレッド
    - ソフトウェアの分野では、並行処理に対応したマイクロプロセッサ（CPU/MPU）およびオペレーティングシステム（OS）におけるプログラムの最小の実行単位をスレッドという。

    - 連続して実行される一本の命令の並び、処理の流れのことで、並行処理を行わない場合は一つの実行プログラム（プロセス）は一つのスレッド（シングルスレッド）で命令を順に実行していく。

    - 並行処理が可能な環境では一つのプログラムが複数のスレッドを持つことができ、それぞれが独立にプログラム中の異なる箇所を並行して実行していくことができる。
    - このような実行方式を「マルチスレッド」（multithreading）という。

    - 一方、オペレーティングシステム（OS）上で複数の異なるプログラムを並行して実行できることは「マルチタスク」「マルチプロセス」等と呼んで区別する。


### マルチタスク【multitasking】マルチプロセス / multi-process マルチプログラミング / multi-programming / 多重プログラミング
- システムなどが、同時に複数のタスク（作業、処理）を並行して実行すること。また、OSがコンピュータやマイクロプロセッサ（CPU/MPU）をそのように運用すること。

- マルチタスクに対応したOSでは複数のプログラムを同時に実行状態に置くことができ、利用者が操作・表示していないプログラムも処理を進めることができる。
- 利用者は複数のソフトウェアを利用する際にいちいち起動・終了を繰り返す必要がなく、即座に別のソフトウェアに切り替えて中断した操作を再開することができる。

- コンピュータ上でのプログラムの実行は、細かく見ると入出力の待ち時間などが発生しており、何もしていない時間に別のプログラムの実行を進めることで計算資源の利用効率を向上させることができる。

- CPU（マイクロプロセッサ）あるいはCPU内部のプロセッサコアが一つしか無いシステムでは同時に一つのプログラムしか実行できないが、その場合は処理時間を極めて短い時間ごとに区切って稼働中のプログラムに割り当て、順番に切り替えてプロセッサを使用することで並行して実行させる。
- この切り替え処理を「コンテキストスイッチ」（context switching）という。



- プリエンプティブマルチタスクとノンプリエンプティブマルチタスク
    - CPUをOSが管理し、処理能力を実行中のプログラムに少しずつ順番に割り当てて実行させる方式を「プリエンプティブマルチタスク」（preemptive multitasking）あるいは「非協調的マルチタスク」と呼ぶ。
    - プログラム側が自発的に制御をOSに明け渡すことで実行プログラムの切り替えを行っていく方式を「ノンプリエンプティブマルチタスク」（nonpreemptive multitasking）あるいは「協調的マルチタスク」「擬似マルチタスク」などという。



- シングルタスク (ユニタスク)
    - システムなどが、一度に一つのタスク（作業、処理）のみを実行可能なことをシングルタスク（single-tasking）あるいはユニタスク（unitasking）という。

    - 初期のコンピュータやOSは基本的にシングルタスクで動作していたが、近年では主要なシステムはほとんどマルチタスク動作が可能となっており、複数のソフトウェアなどを同時に起動して動作させることができる。

    - また、画面表示や操作方式（ユーザインターフェース）の特徴として、起動したソフトウェアが画面全体を占有し、一度に一つのソフトしか表示・操作できない仕組みのことをシングルタスクという場合もある。
    - その際、OSの設計はマルチタスクになっており、利用者から見えない状態（バックグラウンド）で複数のソフトウェアが実行されている場合もある。


#### プリエンプティブマルチタスク【preemptive multitasking】非協調的マルチタスク
- 一つの処理装置（CPU）で並行して複数の処理を進めるマルチタスクで、CPUをOSが管理する方式。
- OSがCPUの処理能力を実行中のプログラムに少しずつ順番に割り当てて実行させる。
- プログラム側の振る舞いによらずOS側から実行を差し止めて待機させる仕組みのことをプリエンプション（preemption）という。
    - 停止したプログラムは状態を保存して待機し、再び順番が巡ってくると実行を再開する。
    - このような切り替え（コンテキストスイッチ：context switching）を短い周期で繰り返すことにより、あたかも同時に複数のプログラムが実行されているように装うことができる。

- OSはCPUの実行時間をあらかじめ決められた短い時間単位に分割してプログラムに割り当てる。
    - これを「タイムスライス」（time slice）と呼び、ハードウェアタイマーなどを利用してマイクロ秒単位で設定したり、CPUのクロック周期の回数ごとに設定したりする。
    - コンテキストスイッチのたびにプログラムの実行状態の退避や呼び戻しなどの処理が発生するため、タイムスライスが短すぎると切り替えにかかるオーバーヘッドが大きくなり実効性能が落ちることになるが、逆に長過ぎると外部との入出力や状況の変化に即座に追随できなくなり、体感的な性能が落ちることになる。

    - 多くのOSはプログラムの実行状態に優先度を設定することができ、必ずしもすべてのプログラムに平等に実行時間を割り当てるわけではない。
    - OSによる実行順の調整はスケジューリング（scheduling）と呼ばれ、OSのカーネルなどに組み込まれたスケジューラ（scheduler）によって制御される。


#### ノンプリエンプティブマルチタスク【non-preemptive multitasking】 擬似マルチタスク / pseudo multitasking / 協調的マルチタスク / cooperative multitasking
- 一つの処理装置（CPU）で並行して複数の処理を進めるマルチタスクで、OSがCPUを管理しない方式。
- 実行中のプログラムが短時間ごとに自発的にOSに制御を返し、CPUの実行状態を並行して稼働している他のプログラムへ切り替える方式である。
- CPUの実行状態をOSが管理しないため、OSの構造はシンプルで済み、タスク切替時の処理の負荷も小さい。
    - しかし、OSへ制御を渡す頻度やタイミングは各プログラム任せとなるため、なかなかCPUを明け渡さない「行儀の悪い」プログラムがいると、OSや他のプログラムの処理が滞ってしまう。
    - また、プログラムに不具合が発生し、特定の箇所で無限ループするなどして正しく切り替え処理を行わなくなってしまうと、OSごとシステム全体が停止してしまうという弱点がある。



### コア数【number of cores】物理コア数
- コンピュータのCPU（MPU/マイクロプロセッサ）内部に内蔵された、独立して稼働するプロセッサコアの数。コアの数だけ複数のプログラムを並列に動作させることができる。
- 元来、マイクロプロセッサ内部には演算や制御を行う回路は一系統だけ搭載され、同時に一つのプログラムを実行していたが、近年では、それぞれが単体のプロセッサのように独立して稼働する「プロセッサコア」を複数内蔵し、同時に複数のプログラムを実行できる「マルチコアプロセッサ」が一般的になってきている。

- マルチコアプロセッサの内部にいくつのコアが内蔵されているかを表すのがコア数で、「2コア」（デュアルコア）であれば同時に2つ、「4コア」（クアッドコア）であれば同時に4つのプログラムを並列に実行することができる。

- コア数が大きいプロセッサほど総合的な性能は高く価格も高いが、あくまで複数のプログラムを並列に処理する能力を表すため、ある特定の一つのプログラムを実行する能力（シングルスレッド性能）がどの程度あるのかはコア数の値だけでは分からない。

- また、各コアは演算や制御を行う回路は独立しているが、キャッシュメモリや外部との通信路などはプロセッサ全体で共用のため、同じ並列度でも複数のプロセッサや複数台のコンピュータで分散処理した場合よりは性能が劣ることが多い。

- 一方、一つのCPUが同時に実行状態に置くことができるプログラムの数を「スレッド数」（論理プロセッサ数）という。
- 一般的なプロセッサではコア数とスレッド数は等しいが、一つのコアで2つのスレッドを同時に実行状態に置く「同時マルチスレッディング」（Intel社のハイパースレッディングなど）に対応したプロセッサでは、スレッド数はコア数の2倍となる（単純に性能が2倍になるわけではない）。

## マイクロプロセッサ【microprocessor】MPU / Micro-Processing Unit
- コンピュータにおける演算や制御などの機能を一枚の半導体チップに集積したもの。
- コンピュータの心臓部であるCPU（中央処理装置）として用いられることが多い。
- メインメモリ（主記憶装置/RAM）などに記録されたコンピュータプログラムを一命令ずつ読み込み、その指示に従ってデータの演算や装置間の転送、他の装置の動作の制御を行う。


- マイクロプロセッサの基本的な設計方針をCISC（Complex Instruction Set Computer）方式とRISC（Reduced Instruction Set Computer）方式に分類する考え方がある。

    CISC方式では、単純なものから複雑で高度なものまで様々な種類の命令を用意して、なるべく多くの処理を一つの命令で実行できるようにすることで能力の向上をはかっている。  
    マイクロプロセッサ発明の当初から主流の設計方針である。  

    一方、CISC方式の限界を乗り越えるべく考案されたのがRISC方式で、命令の種類を絞り、ひとつひとつの命令を単純化して命令長や実行クロック数などをなるべく均等に揃えている。  
    これにより、複数の命令を効率よく同時実行できるようにして性能の向上をはかっている。

    時代が下るにつれて、CISC型の製品もRISC型の製品も互いの長所を取り込む形で発展を続けているため、このような区分は実質的な意味を失いつつあるとする指摘もある。

### コプロセッサ【co-processor】
- コンピュータ内部でCPU（MPU/マイクロプロセッサ）の処理を肩代わりする、特定用途の機能に特化した補助的なプロセッサ。

- コンピュータの構成要素のうち、装置や回路の制御、演算などを担うものをCPU（中央処理装置）という。
- CPUは様々な処理をこなすことができる汎用的な装置だが、処理の負担がCPUに集中するため、システム全体の性能を規定する隘路（ボトルネック）となりやすい。

- そこで、数値演算など特定の機能に特化した安価で単純で処理装置を実装し、CPUの指示で処理を分担する仕組みが考案された。
- CPUに付属して使用することを前提に、特定分野の機能のみを実装したプロセッサのことをコプロセッサという。

- 初期のコプロセッサとしてよく知られるものに、浮動小数点演算に特化した「FPU」（Floating-point Processing Unit/数値演算コプロセッサ）があり、古い文献などではこれを指してコプロセッサと呼ぶことも多い。
- 現在ではCPUの演算機能が向上し、単体のFPUはほとんど開発されていない。

- 近年では、画像処理に特化した「GPU」（Graphics Processing Unit）、信号処理に特化した「DSP」（Digital Signal Processor）、セキュリティ機能に特化した「TPM」（Trusted Platform Module）などのコプロセッサがよく利用されている。
- 一部のサーバ向けNIC（ネットワークインターフェース）に内蔵された、通信処理を肩代わりする各種のオフロードエンジンもコプロセッサの一種である。

# アキュムレータ
# データキャッシュ
# プログラムレジスタ
# 命令レジスタ


### キュー 「FIFO」（First-In First-Out/先入れ先出し）
- 最も基本的なデータ構造の一つで、要素を入ってきた順に一列に並べ、先に入れた要素から順に取り出すという規則で出し入れを行うもの。
- 順番を待つ人の行列と同じ仕組みであるため「待ち行列」とも訳される。
    - キューに要素を追加する操作を「エンキュー」（enqueue）
    - 取り出す操作を「デキュー」（dequeue）

- キューイング (queuing/queueing)
    - キューを用いて要素の管理を行うこと
    - 二つの主体（機器やプログラムなど）の間でデータの受け渡しを非同期に行う手法としてよく用いられる。


- これに対し、積み上げられた座布団のように、最初に入れたものを最後に出す（先に入れたものを後に出す）方式のことを「LIFO」（Last-In First-Out）あるいは「FILO」（First-In Last-Out）という。

### スタック【stack】 「LIFO」（Last-In First-Out/後入れ先出し）あるいは「FILO」（First-In Last-Out/先入れ後出し）
- 要素が入ってきた順に一列に並べ、後に入れた要素から順に取り出すという規則で出し入れを行うもの。
- 本や書類、箱などを積み上げて置く（stack）ことになぞらえてこのように呼ばれる。

- ほとんどのマイクロプロセッサにはメモリ領域に設けたスタックを操作するための機械語の命令やレジスタなどを内蔵しており、機械語のプログラムの実行制御などで非常によく用いられるデータ構造として知られる。
- 特に、サブルーチンや関数を呼び出す際に処理中のデータや戻りアドレスなどを一時的に退避するコールスタック（実行スタック）のことを単にスタックと呼ぶ場合もある。
    - スタックに要素を追加する操作を「プッシュ」（push）
    - 取り出す操作を「ポップ」（pop）という
    - プログラミング言語などによっては、この2つの操作に加え、末尾あるいは指定位置の要素を取り出さずに値を読み込む「ピーク」（peek）、末尾あるいは指定位置の値を書き換える「ポーク」（poke）といった操作を提供している場合もある。

#### プロトコルスタック/ソフトウェアスタック
- ネットワークプロトコル（通信規約）やソフトウェアは物理的な装置や回線に近い部分から利用者に近いものまで、役割に応じて階層構造に分かれていることが多い。
- このとき、互いに相互運用性のあるプロトコルやソフトウェアを積み重ね、全体として一つのシステムや機能を実現したものをプロトコルスタック、ソフトウェアスタックなどということがある。
    - 例えばプロトコルであれば、物理層からアプリケーション層まで、
    ```
    UTPケーブル - Ethernet - IP（Internet Protocol） - TCP（Transmission Control Protocol） - HTTP（Hypertext Transfer Protocol）
    ```
    といったように積み上げた各階層の機能が互いに連携しあって通信が可能となる。





### スーパーバイザモード / supervisor mode カーネルモード【kernel mode】特権モード / privileged mode
- マイクロプロセッサ（CPU/MPU）の実行モードの一つで、すべての命令を制限なく実行できるモード。
- オペレーティングシステム（OS）の中核部（カーネル）が動作するモードとして設計・想定されているためこのように呼ばれる。

    - 現代的な設計のプロセッサは複数の動作モードを持っており、すべての機能や命令を無制限に使用できるカーネルモードと、何らかの制約が加えられているユーザーモード（製品によって他の呼称で呼ばれることもある）に分かれている。

    - カーネルモードはOSのカーネルなどコンピュータの資源やソフトウェアの制御や管理を行うソフトウェアの実行モードで、ハードウェアへの直接アクセスなどユーザーモードでは制限されている動作も行うことができる。
    - アプリケーションソフトなど利用者が直接触れるプログラムのほとんどはユーザーモードで実行される。


# GPU


## タイルベースレンダリング
- 画面のピクセルを一定の大きさの領域に切り分けて、その単位で処理を行うレンダリング方式
- 最初のレンダリングパスで，シーン内に登場するすべてのポリゴン（ジオメトリ）のレンダリングを，画面（＝フレームバッファ）への描画を行わずに実行して，どのタイルにどのポリゴンが配置されるかの情報，ポリゴンリストを作成する。
- そして続くレンダリングパスでは，各タイル単位でのレンダリングを行う。各タイルにどのポリゴンを描画するかは，最初のレンダリングパスで把握できているので，その情報をもとに，タイル単位でポリゴンをドットに分解するラスタライズを行う

- Zバッファ処理に相当することを，タイル単位で行っている

- Zバッファの処理は，グラフィックスメモリへのアクセスを必要とする
- 「タイル単位のZバッファ処理系」は，GPU内部のキャッシュメモリ上で行われる。
    - つまり，グラフィックスメモリ上にZバッファを持たないため，グラフィックスメモリへのアクセスを減らせる

